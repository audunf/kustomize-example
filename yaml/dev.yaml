apiVersion: v1
kind: Service
metadata:
  labels:
    app: sshd-svc
    instance: develop
  name: sshd-svc
  namespace: default
spec:
  externalTrafficPolicy: Cluster
  loadBalancerIP: 10.10.10.10
  ports:
  - port: 22
    protocol: TCP
    targetPort: 22
  selector:
    app: sshd-sfset
    instance: develop
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: background-worker-dep
    instance: develop
  name: background-worker-dep
spec:
  replicas: 1
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      app: background-worker-dep
      instance: develop
  template:
    metadata:
      labels:
        app: background-worker-dep
        instance: develop
    spec:
      containers:
      - args:
        - |
          /usr/sbin/crond -f -d 8
        command:
        - /bin/sh
        - -c
        image: eu.gcr.io/<PROJECT_ID>/background-worker-container:deadbee
        imagePullPolicy: Always
        name: background-worker-dep-container
        resources:
          limits:
            cpu: 100m
            memory: 512Mi
          requests:
            cpu: 50m
            memory: 256Mi
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  labels:
    instance: develop
  name: sshd-sfset
  namespace: default
spec:
  replicas: 2
  selector:
    matchLabels:
      app: sshd-sfset
      instance: develop
  serviceName: sshd-subdomain
  template:
    metadata:
      labels:
        app: sshd-sfset
        instance: develop
    spec:
      containers:
      - command:
        - /bin/sh
        - -c
        - /usr/sbin/sshd -De
        image: eu.gcr.io/<PROJECT_ID>/sshd-container:deadbee
        imagePullPolicy: Always
        livenessProbe:
          initialDelaySeconds: 15
          periodSeconds: 20
          tcpSocket:
            port: 22
        name: sshd-sfset-container
        ports:
        - containerPort: 22
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 10
          tcpSocket:
            port: 22
        resources:
          limits:
            cpu: 200m
            memory: 1024Mi
          requests:
            cpu: 100m
            memory: 512Mi
      subdomain: sshd-subdomain
  updateStrategy:
    type: RollingUpdate
